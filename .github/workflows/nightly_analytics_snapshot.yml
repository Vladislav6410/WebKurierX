name: ğŸŒ™ Nightly Analytics Snapshot

on:
  schedule:
    - cron: "0 2 * * *"   # Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² 02:00 UTC
  workflow_dispatch:

jobs:
  snapshot:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: ğŸ“¦ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: ğŸ”§ Install dependencies
        run: pip install requests pyyaml

      - name: ğŸ§  Run Intelligence Layer fetch
        env:
          HYBRID_FEEDBACK_ENDPOINT: ${{ secrets.HYBRID_FEEDBACK_ENDPOINT }}
          HYBRID_TOKEN: ${{ secrets.HYBRID_API_TOKEN }}
        run: python scripts/pull_hybrid_feedback.py

      - name: ğŸ•“ Create nightly analytics snapshot
        run: |
          mkdir -p docs/analytics
          SNAPSHOT="docs/analytics/$(date +'%Y-%m-%d').md"
          cp docs/FEEDBACK_STATUS.md "$SNAPSHOT"
          echo "âœ… Saved snapshot to $SNAPSHOT"

      - name: ğŸ“¤ Commit and push snapshot
        run: |
          git config --global user.name "WebKurierX Bot"
          git config --global user.email "bot@webkurier.ai"
          git add docs/analytics/
          git commit -m "ğŸ“Š Nightly analytics snapshot $(date +'%Y-%m-%d')" || echo "No changes"
          git push